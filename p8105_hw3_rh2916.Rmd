---
title: "p8105_hw3_rh2916"
author: "Rui Huang"
date: "October 6, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(janitor)
library(skimr)
library(dplyr)
library(ggridges)
library(patchwork)
library(lubridate)
library(hexbin)
```

## Problem 1
```{r}
library(p8105.datasets)
data(brfss_smart2010)
```

```{r}
problem1_data =
  brfss_smart2010 %>%
  janitor::clean_names() %>%
  filter(topic == "Overall Health" ) %>%
  mutate(response = as.factor(response)) %>%
  select(-class, -topic, -question, -sample_size, -(confidence_limit_low : geo_location))
```

### In 2002, which states were observed at 7 locations?

```{r}
problem1_data %>%
  filter(year == 2002) %>%
  group_by(locationabbr) %>%
  summarize(n_locationdesc = n_distinct(locationdesc)) %>%
  filter(n_locationdesc == 7)
```


Based on the result, CT, FL and NC were observed at 7 locations in 2002.

### Make a “spaghetti plot” that shows the number of observations in each state from 2002 to 2010.

```{r}
problem1_data %>%
  group_by(year, locationabbr) %>%
  summarize(n_obs = n()) %>%
  ggplot(aes(x = year, y = n_obs, color = locationabbr)) +
  geom_line() +
  labs(
    title = "Spaghetti plot for number of observations in each state",
    x = "Year",
    y = "Number of observations",
    caption = "Data from the rnoaa package"
  ) 
```

Based on the result, we can find that the fluctuation for observations increases by year. And the maximum observation number is about 220, which occurs in 2007. The majority of observation numbers are under 100. However, it is difficult to tell the observaion differences between different states by the spaghetti plot.

### Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.

```{r}
knitr::kable(
  problem1_data %>%
  spread(key = response, value = data_value) %>%
  janitor::clean_names() %>%
  filter((year == 2002 | year == 2006 |year == 2010) & locationabbr == "NY") %>%
  group_by(year) %>%
  summarize(mean_prop_excellent = mean(excellent/100, na.rm = T),
            sd_prop_excellent = sd(excellent/100, na.rm = T))
)
```

From the table we can find that the mean proportion of excellent in 2002 is higher than 2006 and 2010, while the sd of proportion of excellent in 2002 is also the highest.  The mean proportion of excellent in 2006 nd 2010 are similar.
 

### For each year and state, compute the average proportion in each response category. Make a five-panel plot that shows the distribution of these state-level averages over time.

```{r}
problem1_data %>%
  group_by(year, locationabbr, response) %>%
  summarise(state_mean = mean(data_value)/100) %>%
  ggplot(aes(x = year, y = state_mean, color = response)) +
  geom_point() +
  geom_smooth(se = F) +
  facet_grid(. ~response) +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(
    title = "Distribution of state-level average responses over time",
    x = "Year",
    y = "State-level average responses"
  )
```



From the plot, we can find that for each year the proportion for very good is the highest an the proportion for poor is the lowest. The proportion distribution for this 9 years are similar.
